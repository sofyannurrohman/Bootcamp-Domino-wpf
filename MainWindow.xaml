<Window x:Class="DominoGameWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:DominoGame.Converters"
        xmlns:models="clr-namespace:DominoGame.Models"
        Title="Domino Block Game"
        Height="600" Width="900"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E">

    <Window.Resources>
        <!-- === CONVERTERS === -->
        <conv:TileSizeConverter x:Key="TileSizeConverter"
                                NormalWidth="60"
                                NormalHeight="120"/>
        <conv:TileHighlightConverter x:Key="TileHighlightConverter"/>
        <conv:TilePlayableConverter x:Key="TilePlayableConverter"/>
        <conv:TilePlayableOpacityConverter x:Key="TilePlayableOpacityConverter"/>

        <!-- === STYLES === -->
        <Style x:Key="TileImageStyle" TargetType="Image">
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="Stretch" Value="Uniform"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <RotateTransform Angle="0"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- === DATA TEMPLATES === -->

        <!-- Board Tile -->
        <DataTemplate x:Key="BoardTileTemplate" DataType="{x:Type models:DominoTile}">
            <Border CornerRadius="6" Margin="3" Background="#3C3C3C" Padding="2">
                <Image Source="{Binding Image}"
                       Style="{StaticResource TileImageStyle}">
                    <Image.Width>
                        <Binding Path="RotationAngle"
                                 Converter="{StaticResource TileSizeConverter}"
                                 ConverterParameter="Width"/>
                    </Image.Width>
                    <Image.Height>
                        <Binding Path="RotationAngle"
                                 Converter="{StaticResource TileSizeConverter}"
                                 ConverterParameter="Height"/>
                    </Image.Height>
                    <Image.RenderTransform>
                        <RotateTransform Angle="{Binding RotationAngle}"/>
                    </Image.RenderTransform>
                </Image>
            </Border>
        </DataTemplate>

        <!-- Player Hand Tile -->
        <DataTemplate x:Key="PlayerTileTemplate" DataType="{x:Type models:DominoTile}">
            <Button Margin="4"
                    Padding="6"
                    Background="#2D2D30"
                    Click="TileButton_Click">

                <!-- Enable hanya kalau playable -->
                <Button.IsEnabled>
                    <MultiBinding Converter="{StaticResource TilePlayableConverter}">
                        <Binding/>
                        <Binding Path="game.CurrentPlayer"
                                 RelativeSource="{RelativeSource AncestorType=Window}" />
                        <Binding Path="game.Board"
                                 RelativeSource="{RelativeSource AncestorType=Window}" />
                    </MultiBinding>
                </Button.IsEnabled>

                <Border CornerRadius="6" Padding="2">
                    <!-- Highlight -->
                    <Border.Background>
                        <MultiBinding Converter="{StaticResource TileHighlightConverter}">
                            <Binding/>
                            <Binding Path="game.CurrentPlayer"
                                     RelativeSource="{RelativeSource AncestorType=Window}" />
                            <Binding Path="game.Board"
                                     RelativeSource="{RelativeSource AncestorType=Window}" />
                        </MultiBinding>
                    </Border.Background>

                    <!-- Opacity -->
                    <Border.Opacity>
                        <MultiBinding Converter="{StaticResource TilePlayableOpacityConverter}">
                            <Binding/>
                            <Binding Path="game.CurrentPlayer"
                                     RelativeSource="{RelativeSource AncestorType=Window}" />
                            <Binding Path="game.Board"
                                     RelativeSource="{RelativeSource AncestorType=Window}" />
                        </MultiBinding>
                    </Border.Opacity>

                    <!-- Tile Image -->
                    <Image Source="{Binding Image}"
                           Style="{StaticResource TileImageStyle}">
                        <Image.Width>
                            <Binding Path="RotationAngle"
                                     Converter="{StaticResource TileSizeConverter}"
                                     ConverterParameter="Width"/>
                        </Image.Width>
                        <Image.Height>
                            <Binding Path="RotationAngle"
                                     Converter="{StaticResource TileSizeConverter}"
                                     ConverterParameter="Height"/>
                        </Image.Height>
                        <Image.RenderTransform>
                            <RotateTransform Angle="{Binding RotationAngle}"/>
                        </Image.RenderTransform>
                    </Image>
                </Border>
            </Button>
        </DataTemplate>
    </Window.Resources>

    <!-- === LAYOUT === -->
    <DockPanel LastChildFill="True" Margin="10">

        <!-- Title & Status -->
        <StackPanel DockPanel.Dock="Top"
                    Margin="0,0,0,10"
                    HorizontalAlignment="Center">
            <TextBlock Text="Domino Block Game"
                       FontSize="22"
                       FontWeight="Bold"
                       Foreground="#FFD700"/>
            <TextBlock x:Name="StatusText"
                       FontSize="16"
                       Foreground="White"
                       Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Board Tiles -->
        <Border DockPanel.Dock="Top"
                Background="#2D2D30"
                CornerRadius="8"
                Padding="10"
                Margin="0,0,0,10">
            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Disabled">
                <ItemsControl x:Name="BoardTiles"
                              ItemTemplate="{StaticResource BoardTileTemplate}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Center"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <!-- Player Hand -->
        <Border DockPanel.Dock="Bottom"
                Background="#252526"
                CornerRadius="8"
                Padding="10"
                Margin="0,10,0,0">
            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Disabled">
                <ItemsControl x:Name="PlayerHand"
                              ItemTemplate="{StaticResource PlayerTileTemplate}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Center"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </ScrollViewer>
        </Border>
    </DockPanel>
</Window>
