<Window x:Class="DominoGameWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:DominoGame.Converters"
        xmlns:models="clr-namespace:DominoGame.Models"
        xmlns:helpers="clr-namespace:DominoGame.Helpers"
        Title="Domino Block Game 🂃"
        Height="600" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#000000">

    <Window.Resources>
        <conv:TileSizeConverter x:Key="TileSizeConverter" NormalWidth="60" NormalHeight="120"/>
        <conv:TileHighlightConverter x:Key="TileHighlightConverter"/>
        <conv:TilePlayableConverter x:Key="TilePlayableConverter"/>
        <conv:TilePlayableOpacityConverter x:Key="TilePlayableOpacityConverter"/>
        <conv:BoolToScaleXConverter x:Key="BoolToScaleXConverter"/>
        <helpers:BindingProxy x:Key="TileProxy"/>
        <Style x:Key="TileImageStyle" TargetType="Image">
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="Stretch" Value="Uniform"/>
        </Style>

        <DataTemplate x:Key="SharedTileImageTemplate" DataType="{x:Type models:DominoTile}">
            <Grid>
                <Grid.Resources>
                    <helpers:BindingProxy x:Key="TileDataProxy" Data="{Binding}"/>
                </Grid.Resources>

                <Image Source="{Binding DisplayImage}" 
                       Style="{StaticResource TileImageStyle}"
                       Width="{Binding RotationAngle, Converter={StaticResource TileSizeConverter}, ConverterParameter=Width}"
                       Height="{Binding RotationAngle, Converter={StaticResource TileSizeConverter}, ConverterParameter=Height}">
                    <Image.RenderTransform>
                        <TransformGroup>
                            <RotateTransform Angle="{Binding Data.RotationAngle, Source={StaticResource TileDataProxy}}"/>
                            <ScaleTransform ScaleX="{Binding Data.IsFlipped, Source={StaticResource TileDataProxy}, Converter={StaticResource BoolToScaleXConverter}}"
                                            ScaleY="1"/>
                        </TransformGroup>
                    </Image.RenderTransform>
                </Image>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="PlayerTileTemplate" DataType="{x:Type models:DominoTile}">
            <Button Margin="10" Padding="2" Background="#2D2D30" Height="150" Width="90"
                    Command="{Binding DataContext.PlayTileCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                    CommandParameter="{Binding}">
                <Border CornerRadius="4" Padding="1">
                    <Border.Background>
                        <MultiBinding Converter="{StaticResource TileHighlightConverter}">
                            <Binding/>
                            <Binding Path="DataContext.CurrentPlayer" RelativeSource="{RelativeSource AncestorType=Window}"/>
                            <Binding Path="DataContext.Board" RelativeSource="{RelativeSource AncestorType=Window}"/>
                        </MultiBinding>
                    </Border.Background>
                    <Border.Opacity>
                        <MultiBinding Converter="{StaticResource TilePlayableOpacityConverter}">
                            <Binding/>
                            <Binding Path="DataContext.CurrentPlayer" RelativeSource="{RelativeSource AncestorType=Window}"/>
                            <Binding Path="DataContext.Board" RelativeSource="{RelativeSource AncestorType=Window}"/>
                        </MultiBinding>
                    </Border.Opacity>
                    <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource SharedTileImageTemplate}"/>
                </Border>
            </Button>
        </DataTemplate>

        <!-- ================== BOARD TILE TEMPLATE ================== -->
        <DataTemplate x:Key="BoardTileTemplate" DataType="{x:Type models:DominoTile}">
            <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource SharedTileImageTemplate}"/>
        </DataTemplate>
    </Window.Resources>

    <DockPanel LastChildFill="True" Margin="10">

        <StackPanel DockPanel.Dock="Top" HorizontalAlignment="Center" Margin="0,0,0,10">
            <TextBlock Text="Domino Block Game 🂃"
                       FontSize="22"
                       FontWeight="Bold"
                       Foreground="#1DCD9F"/>
            <TextBlock Text="{Binding StatusText}"
                       FontSize="16"
                       Foreground="White"
                       Margin="0,5,0,0"/>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,5,0,0">
                <TextBlock FontSize="16" Foreground="#00FF00">
                    <TextBlock.Text>
                        <MultiBinding StringFormat="Round: {0}/{1}">
                            <Binding Path="CurrentRound"/>
                            <Binding Path="MaxRounds"/>
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="20,0,0,0">
                    <TextBlock Text="You: " FontSize="16" Foreground="#FFD700"/>
                    <TextBlock Text="{Binding PlayerScore}" FontSize="16" Foreground="White" Margin="0,0,20,0"/>

                    <TextBlock Text="Computer: " FontSize="16" Foreground="#FFD700"/>
                    <TextBlock Text="{Binding ComputerScore}" FontSize="16" Foreground="White"/>
                </StackPanel>


            </StackPanel>
        </StackPanel>

        <Border DockPanel.Dock="Top" Background="#2D2D30" CornerRadius="8" Padding="10" Margin="0,0,0,10">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding BoardTiles}"
                              ItemTemplate="{StaticResource BoardTileTemplate}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <Border DockPanel.Dock="Bottom" Background="#252526" CornerRadius="8" Padding="10" Margin="0,10,0,0">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <ItemsControl ItemsSource="{Binding PlayerHand}"
                              ItemTemplate="{StaticResource PlayerTileTemplate}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </ScrollViewer>
        </Border>
    </DockPanel>
</Window>